{% extends "layout.html" %}
{% block content %}
    <div style="margin: 0 auto; width: 50rem; background-color: white; border-radius: 17px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 15px;">
            <div>   
                <h2>Community</h1>
                
                {% if section == 'recommendations' %}
                    <p>Visited a delicious restraurant recently? Tell us about it!</p>
                {% elif section == 'random' %}
                    <p>Discuss anything</p>
                {% elif section == 'politics' %}
                    <p>Discussions related to politics</p>
                {% elif section == 'jobs' %}
                    <p>Post job adverts here</p>
                {% else %}
                    <p>Discuss various topics with other teachers</p>
                {% endif %}
            </div>
            <div>
                <i class="fa-solid fa-pencil"></i>
                {% if request.args.get('b') %}
                    <a class="create-btn" href="{{ url_for('materials.create_material', level='community', type=request.args.get('b')) }}">Make a post</a>
                {% else %}
                    <a class="create-btn" href="{{ url_for('materials.create_material', level='community') }}">Make a post</a>
                {% endif %}
            </div>
        </div>

        <nav class="search-nav" id="questions-filter-nav">
            <a href="{{ url_for('materials.forum') }}">All</a>
            <a href="{{ url_for('materials.forum', b='languages') }}">Language Learning</a>
            <a href="{{ url_for('materials.forum', b='recommendations') }}">ë§›ì§‘</a>
            <a href="{{ url_for('materials.forum', b='teaching') }}">Teaching</a>
            <a href="{{ url_for('materials.forum', b='jobs') }}">Job Adverts</a>
            <a href="{{ url_for('materials.forum', b='travel') }}">Travel</a>
            <a href="{{ url_for('materials.forum', b='korea') }}">Korea</a>
            <a href="{{ url_for('materials.forum', b='politics') }}">Politics</a>
            <a href="{{ url_for('materials.forum', b='random') }}">Random</a>
           
            <form method="POST" action="" id="filter-submit">
                <i id="custom-select" class="fa-solid fa-ellipsis-vertical"></i>
            </form>
     
        </nav>
        
        <div class="material-posts">
            {% if posts.total == 0 %}
                <h3>Hm...it seems like there are no results with those attributes. ðŸ™…</h3>
                <p>Try using a different filter or use the searchbar above.</p>
            {% endif %}
            {% for post in posts %}
                <a href="{{ url_for('materials.material', material_id=post.id)}}">
                    <div class="material-post-container">
                
                    <div style="width: 100%;">
                        <div class="material-post-header">
                            <div style="display: flex;">
                                <div class="question-post-title">
                                {{ post.title }}
                                </div>
                            </div>
                        </div>
                        <div class="question-post-content">
                            {{ post.content|striptags|escape|replace('\n', '')|replace('  ', ' ')|truncate(200, killwords=False, end='...') }}
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div class="material-post-footer">
                                <div style="display: flex; align-items: center;"> 
                                    <div class="material-post-tags">
                                        <div class="tag">
                                            {% if post.grade == 'recommendations' %}
                                                ë§›ì§‘ 
                                            {% else %}
                                                {{ post.grade }}
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="material-post-comment-info">
                                    <i class="fa-regular fa-heart"></i>
                                    <span class="material-post-likes">{{ post.likes|length }}</span>
                                    <i class="fa-regular fa-comment"></i>
                                    <span class="material-post-comments">{{ post.likes|length }}</span>
                                </div>
                            </div>
                            <div class="material-post-user-info">
                                <span class="material-post-author">Asked by</span>
                                <img class="material-post-profile-picture" src="{{ url_for('static', filename='pics/' + post.creator.image_file)}}" alt="Profile Picture">
                                <span class="material-post-author">{{ post.creator.username }}</span>
                                <span class="material-post-date">{{ post_timestamp(post.date_posted) }} ago</span>
                            </div>
                        </div>
                    </div>
                    </div>
                </a>
            {% endfor %}
        </div>
        {% for page_num in posts.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if page_num %}
                {% if posts.page == page_num %}
                    <a style="background-color: rgba(244, 130, 37, 1); color: white;" class="paginate-btn" href="{{ url_for('materials.load_materials', level=level, page=page_num) }}">{{ page_num }}</a>
                {% else %}
                    <a class="paginate-btn" href="{{ url_for('materials.load_materials', level=level, page=page_num) }}">{{ page_num }}</a>
                {% endif %}
            {% else %}
                ...
            {% endif %}
        {% endfor %}    
    </div>
    <script src="{{ url_for('static', filename='js/customSelectBtn.js') }}"></script>
    <script src="{{ url_for('static', filename='js/search.js') }}"></script>
{% endblock content %}

